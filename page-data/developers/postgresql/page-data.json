{"componentChunkName":"component---node-modules-confluenza-gatsby-theme-confluenza-src-templates-markdown-template-js","path":"/developers/postgresql/","result":{"data":{"site":{"siteMetadata":{"title":"Identity Box","editBaseUrl":"https://github.com/identity-box/identity-box/blob/master"}},"config":{"nodes":[{"tag":"user","title":"Identity Box"},{"tag":"developer","title":"Developers"},{"tag":"beta","title":"Early Adopters"},{"tag":"component","title":"Components"},{"tag":"service","title":"Services"},{"tag":"utils","title":"Utils"}]},"doc":{"html":"<p>Identity Box grows and storing various configuration data in plain text files not only becomes hard to manage but also does not scale, especially with simultaneous write access.</p>\n<h2 id=\"installation\" style=\"position:relative;\"><a href=\"#installation\" aria-label=\"installation permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Installation</h2>\n<p>Following the instructions from <a href=\"https://www.postgresql.org/download/linux/ubuntu/\">https://www.postgresql.org/download/linux/ubuntu/</a> should be enough. I validated it on Odroid (ARM) and it worked without any surprises. Thus, it should be safe to assume (I will validate it soon) that it will work even beter on any generic hardware supporting ubuntu (Intel-based in particular).</p>\n<p>The instructions in this document has been validated on the most recent version of PostgreSQL, version 16, but from my past experiences with version 11, I expect that any version including and above version 11 will not pose any serious problems.</p>\n<p>The main PostgreSQL configuration file - <code class=\"language-text\">postgresql.conf</code> - is located at <code class=\"language-text\">/etc/postgresql/16/main/</code>. The <em>PostgreSQL Client Authentication Configuration File</em> <code class=\"language-text\">pg_hba.conf</code>, which we will need when configuring PostgreSQL authentication, can be found at the same location. Its location can also be retrieved by running in the terminal:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> <span class=\"token function\">su</span> postgres\npostgres@idbox-1:/home/idbox$ psql\npsql <span class=\"token punctuation\">(</span><span class=\"token number\">16.1</span> <span class=\"token punctuation\">(</span>Ubuntu <span class=\"token number\">16.1</span>-1.pgdg20.04+1<span class=\"token punctuation\">))</span>\nType <span class=\"token string\">\"help\"</span> <span class=\"token keyword\">for</span> help.\n\n<span class=\"token assign-left variable\">postgres</span><span class=\"token operator\">=</span><span class=\"token comment\"># SHOW hba_file;</span>\n              hba_file\n-------------------------------------\n /etc/postgresql/16/main/pg_hba.conf\n<span class=\"token punctuation\">(</span><span class=\"token number\">1</span> row<span class=\"token punctuation\">)</span>\n\n<span class=\"token assign-left variable\">postgres</span><span class=\"token operator\">=</span><span class=\"token comment\"># q</span>\npostgres@idbox-1:/home/idbox$ <span class=\"token builtin class-name\">exit</span></code></pre></div>\n<p>In earlier versions of PostgreSQL, the installation script provided additional information about how to enable and start PostgreSQL as a service (see the next section <a href=\"#installation-on-raspberrypi\">Installation On RaspberryPi</a>). This should not be needed anymore. After installing PostgreSQL, the service should be already configured and enabled. In case of doubt, the service can be enabled by running:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> systemctl <span class=\"token builtin class-name\">enable</span> postgresql</code></pre></div>\n<p>To check the status of the PostgreSQL service run:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> systemctl status postgresql\n‚óè postgresql.service - PostgreSQL RDBMS\n     Loaded: loaded <span class=\"token punctuation\">(</span>/lib/systemd/system/postgresql.service<span class=\"token punctuation\">;</span> enabled<span class=\"token punctuation\">;</span> vendor preset: enabled<span class=\"token punctuation\">)</span>\n     Active: active <span class=\"token punctuation\">(</span>exited<span class=\"token punctuation\">)</span> since Thu <span class=\"token number\">2023</span>-11-16 00:13:45 CET<span class=\"token punctuation\">;</span> 4min 33s ago\n    Process: <span class=\"token number\">1114</span> <span class=\"token assign-left variable\">ExecStart</span><span class=\"token operator\">=</span>/bin/true <span class=\"token punctuation\">(</span>code<span class=\"token operator\">=</span>exited, <span class=\"token assign-left variable\">status</span><span class=\"token operator\">=</span><span class=\"token number\">0</span>/SUCCESS<span class=\"token punctuation\">)</span>\n   Main PID: <span class=\"token number\">1114</span> <span class=\"token punctuation\">(</span>code<span class=\"token operator\">=</span>exited, <span class=\"token assign-left variable\">status</span><span class=\"token operator\">=</span><span class=\"token number\">0</span>/SUCCESS<span class=\"token punctuation\">)</span>\n\nNov <span class=\"token number\">16</span> 00:13:45 idbox-1 systemd<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>: Starting PostgreSQL RDBMS<span class=\"token punctuation\">..</span>.\nNov <span class=\"token number\">16</span> 00:13:45 idbox-1 systemd<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>: Finished PostgreSQL RDBMS.</code></pre></div>\n<p>To read some legacy notes on installing PostgreSQL on Raspberry Pi devices, please check Section <a href=\"#installation-on-raspberrypi\">Installation On RaspberryPi</a> at the end of this page.</p>\n<h2 id=\"postgresql-and-authentication\" style=\"position:relative;\"><a href=\"#postgresql-and-authentication\" aria-label=\"postgresql and authentication permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PostgreSQL and authentication</h2>\n<p>Right after the installation, PostgreSQL can only be accessed from the localhost using the so called <a href=\"https://www.postgresql.org/docs/current/auth-peer.html\">peer authentication</a>:</p>\n<blockquote>\n<p>The peer authentication method works by obtaining the client's operating system user name from the kernel and using it as the allowed database user name (with optional user name mapping). This method is only supported on local connections.</p>\n</blockquote>\n<p>Thanks to the peer authentication method we can conveniently access our database without any password by just doing <code class=\"language-text\">sudo su postgres</code> as shown above.</p>\n<blockquote>\n<p>Notice, that we have a database user named <code class=\"language-text\">postgres</code> as well as an operating system user account also named <code class=\"language-text\">postgres</code>. This is specific to the <code class=\"language-text\">peer</code> authentication method which requires that the same username exists in the operating system and in PostgreSQL. This works only for local connection in UNIX. See also <a href=\"https://dba.stackexchange.com/a/83233/224568\">PostgreSQL: Remove password requirement for user postgres</a> on Database Administrators on StackExchange.</p>\n</blockquote>\n<p>When using the peer authentication method for the default superuser <code class=\"language-text\">postgres</code>, in order to run a command on a database we have to do something like:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> <span class=\"token parameter variable\">-u</span> postgres psql <span class=\"token parameter variable\">-c</span> <span class=\"token string\">\"\\l\"</span>\n<span class=\"token comment\"># or</span>\n$ <span class=\"token function\">sudo</span> <span class=\"token parameter variable\">-u</span> postgres psql <span class=\"token parameter variable\">-c</span> <span class=\"token string\">\"SELECT datname FROM pg_database;\"</span>\n<span class=\"token comment\"># or</span>\n$ <span class=\"token function\">sudo</span> <span class=\"token function\">su</span> postgres <span class=\"token parameter variable\">-c</span> <span class=\"token string\">'psql -c \"\\l\"'</span>\n<span class=\"token comment\"># or</span>\n$ <span class=\"token function\">sudo</span> <span class=\"token function\">su</span> postgres <span class=\"token parameter variable\">-c</span> <span class=\"token string\">'psql -c \"SELECT datname FROM pg_database;\"'</span></code></pre></div>\n<p>And even though you have <code class=\"language-text\">psql</code> utility locally installed, you cannot just run:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ psql <span class=\"token parameter variable\">-U</span> postgres postgres\npsql: FATAL:  Peer authentication failed <span class=\"token keyword\">for</span> user <span class=\"token string\">\"postgres\"</span></code></pre></div>\n<blockquote>\n<p>In the snippet above, <code class=\"language-text\">postgres</code> is both the username and a default database on the PosgreSQL DBMS.</p>\n</blockquote>\n<p>For this to work, you would have to set a password on the database user <code class=\"language-text\">postgres</code>, but we do not want to do that. As indicated <a href=\"https://stackoverflow.com/a/40151841/1272679\">here</a>, a better option is to create another superuser account. That way, if the credentials for that superuser is compromised, one can always ssh into the actual database host and manually delete the superuser using:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> <span class=\"token parameter variable\">-u</span> postgres psql <span class=\"token parameter variable\">-c</span> <span class=\"token string\">\"DROP ROLE superuser;\"</span></code></pre></div>\n<p>By not setting the password on the <code class=\"language-text\">postgres</code> user, we guarantee that we will never have all our superusers compromised: when you don't set the password, any password login attempt to <code class=\"language-text\">postgres</code> user will be denied whereas you can still use <code class=\"language-text\">sudo -u postgres psql -c</code> locally to get the job done.</p>\n<p>Thus, if we want to use psql locally, or if we want to enable remote access to our database, we will need to add another user role.</p>\n<p>Before adding a new role, let's make sure that we use the most secure variant of the password authentication which is <code class=\"language-text\">scram-sha-256</code> (it is more secure than legacy <code class=\"language-text\">md5</code>). To make it the default, we set <code class=\"language-text\">password_encryption</code> in <code class=\"language-text\">/etc/postgresql/16/main/postgresql.conf</code> so that it reads as follows:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">password_encryption <span class=\"token operator\">=</span> scram-sha-256     <span class=\"token comment\"># md5 or scram-sha-256</span></code></pre></div>\n<p>Now restart the PostgreSQL server:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> systemctl restart postgresql</code></pre></div>\n<p>Now we can create a new role <code class=\"language-text\">admin</code> that we will use to remotely perform database\nadministration.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> <span class=\"token function\">su</span> postgres\npostgres@idbox-1:/home/pi$ createuser <span class=\"token parameter variable\">-s</span> <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">-P</span> <span class=\"token parameter variable\">-e</span> admin\nEnter password <span class=\"token keyword\">for</span> new role:\nEnter it again:\nSELECT pg_catalog.set_config<span class=\"token punctuation\">(</span><span class=\"token string\">'search_path'</span>, <span class=\"token string\">''</span>, <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\nCREATE ROLE admin PASSWORD <span class=\"token string\">'md5739b151e6c6444592dc86f07b44ebde3'</span> SUPERUSER CREATEDB CREATEROLE INHERIT LOGIN<span class=\"token punctuation\">;</span>\npostgres@idbox-1:/home/pi$ psql\npsql <span class=\"token punctuation\">(</span><span class=\"token number\">11.10</span> <span class=\"token punctuation\">(</span>Raspbian <span class=\"token number\">11.10</span>-0+deb10u1<span class=\"token punctuation\">))</span>\nType <span class=\"token string\">\"help\"</span> <span class=\"token keyword\">for</span> help.\n\n<span class=\"token assign-left variable\">postgres</span><span class=\"token operator\">=</span><span class=\"token comment\"># \\du</span>\n                                   List of roles\n Role name <span class=\"token operator\">|</span>                         Attributes                         <span class=\"token operator\">|</span> Member of\n-----------+------------------------------------------------------------+-----------\n admin     <span class=\"token operator\">|</span> Superuser, Create role, Create DB                          <span class=\"token operator\">|</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n postgres  <span class=\"token operator\">|</span> Superuser, Create role, Create DB, Replication, Bypass RLS <span class=\"token operator\">|</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>Superusers get the <code class=\"language-text\">CREATEROLE</code> attribute assigned by default. We do not need it and then we will remove it:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token assign-left variable\">postgres</span><span class=\"token operator\">=</span><span class=\"token comment\"># ALTER ROLE admin NOCREATEROLE;</span>\nALTER ROLE\n<span class=\"token assign-left variable\">postgres</span><span class=\"token operator\">=</span><span class=\"token comment\"># \\du</span>\n                                   List of roles\n Role name <span class=\"token operator\">|</span>                         Attributes                         <span class=\"token operator\">|</span> Member of\n-----------+------------------------------------------------------------+-----------\n admin     <span class=\"token operator\">|</span> Superuser, Create DB                                       <span class=\"token operator\">|</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n postgres  <span class=\"token operator\">|</span> Superuser, Create role, Create DB, Replication, Bypass RLS <span class=\"token operator\">|</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n<span class=\"token assign-left variable\">postgres</span><span class=\"token operator\">=</span><span class=\"token comment\">#</span></code></pre></div>\n<p>Now we edit the <code class=\"language-text\">/etc/postgresql/16/main/pg_hba.conf</code> where we set authentication options for the new <code class=\"language-text\">admin</code> role:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">local</span>   all   postgres    peer\n<span class=\"token builtin class-name\">local</span>   all   admin       scram-sha-256</code></pre></div>\n<blockquote>\n<p>Make sure to restart the PostgreSQL service after changing the configuration files.</p>\n</blockquote>\n<p>Having the <em>admin</em> user properly configured, lets create even more restricted user role that will be used by Identity Box services:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> <span class=\"token function\">su</span> postgres\npostgres@idbox-1:/home/idbox$ createuser <span class=\"token parameter variable\">-P</span> <span class=\"token parameter variable\">-e</span> idbox\nEnter password <span class=\"token keyword\">for</span> new role:\nEnter it again:\nSELECT pg_catalog.set_config<span class=\"token punctuation\">(</span><span class=\"token string\">'search_path'</span>, <span class=\"token string\">''</span>, <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nCREATE ROLE idbox PASSWORD <span class=\"token string\">'SCRAM-SHA-256$4096:+uQKWsbuItKvVtPb/e0Kmg==$XT4os8G5xP8uZ+tU04bMAa1GYuHy7vSK2R6DSAFFDlY=:f51Djrbc7vTfYlHAhj9AKTsQBZo/DOjUJaqhjsc+iY8='</span> NOSUPERUSER NOCREATEDB NOCREATEROLE INHERIT LOGIN NOREPLICATION NOBYPASSRLS<span class=\"token punctuation\">;</span>\npostgres@idbox-1:/home/idbox$ psql\npsql <span class=\"token punctuation\">(</span><span class=\"token number\">16.1</span> <span class=\"token punctuation\">(</span>Ubuntu <span class=\"token number\">16.1</span>-1.pgdg20.04+1<span class=\"token punctuation\">))</span>\nType <span class=\"token string\">\"help\"</span> <span class=\"token keyword\">for</span> help.\n\n<span class=\"token assign-left variable\">postgres</span><span class=\"token operator\">=</span><span class=\"token comment\"># \\du</span>\n                             List of roles\n Role name <span class=\"token operator\">|</span>                         Attributes\n-----------+------------------------------------------------------------\n admin     <span class=\"token operator\">|</span> Superuser, Create DB\n idbox     <span class=\"token operator\">|</span>\n postgres  <span class=\"token operator\">|</span> Superuser, Create role, Create DB, Replication, Bypass RLS\n\n<span class=\"token assign-left variable\">postgres</span><span class=\"token operator\">=</span><span class=\"token comment\"># \\q</span>\npostgres@idbox-1:/home/idbox$</code></pre></div>\n<p>Finally, in the same terminal, lets create a database for Identity Box:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">postgres@idbox-1:/home/idbox$ createdb <span class=\"token parameter variable\">-e</span> <span class=\"token parameter variable\">-O</span> idbox idboxdb\nSELECT pg_catalog.set_config<span class=\"token punctuation\">(</span><span class=\"token string\">'search_path'</span>, <span class=\"token string\">''</span>, <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nCREATE DATABASE idboxdb OWNER idbox<span class=\"token punctuation\">;</span>\npostgres@idbox-1:/home/idbox$</code></pre></div>\n<p>With new <code class=\"language-text\">idbox</code> role added, we can now run:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ psql <span class=\"token parameter variable\">-U</span> idbox idboxdb\nPassword <span class=\"token keyword\">for</span> user idbox:\npsql <span class=\"token punctuation\">(</span><span class=\"token number\">16.1</span> <span class=\"token punctuation\">(</span>Ubuntu <span class=\"token number\">16.1</span>-1.pgdg20.04+1<span class=\"token punctuation\">))</span>\nType <span class=\"token string\">\"help\"</span> <span class=\"token keyword\">for</span> help.\n\n<span class=\"token assign-left variable\">idboxdb</span><span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">\\</span>q</code></pre></div>\n<h2 id=\"macos-client\" style=\"position:relative;\"><a href=\"#macos-client\" aria-label=\"macos client permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>macOS client</h2>\n<p>Following <a href=\"https://www.postgresql.org/download/macosx/\">macOS packages</a> page from PostgreSQL documentation, we can download a macOS installer <a href=\"https://www.enterprisedb.com/downloads/postgres-postgresql-downloads\">here</a>.</p>\n<p>The installer will create <code class=\"language-text\">PostgreSQL 16</code> folder in <code class=\"language-text\">/Applications</code>. It will also install a handy <em>pgAdmin 4</em> application and command line tools (and some other useful stuff).</p>\n<blockquote>\n<p>If for any reason the bundled <em>pgAdmin 4</em> application has issues working on macos (like when it looks like doing nothing after double-clicking the app icon). If this happens, a solution may be to install <em>pgAdmin 4</em> directly from <a href=\"https://www.postgresql.org/ftp/pgadmin/pgadmin4/\">https://www.postgresql.org/ftp/pgadmin/pgadmin4/</a>.</p>\n</blockquote>\n<p>We tested version <code class=\"language-text\">7.8</code> of <em>pgAdmin 4</em> and here are the installation settings we used:</p>\n<p><a id=\"figure-1\"></a></p>\n<div class=\"scrollable flex-wrap responsive\">\n<div class=\"content-600\">\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/997c7ed87d7cfdb089490c45c448da9b/0a47e/macos-installation.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 77.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAACcUlEQVR42qVT2U4iQRTtb52Pmed5nn+YF4QEJZEoAdxGAt1AbDGCAr3SazV71/WeGlEYnfgwlZzUfu49t05p2ai1jOIwXWSZyEQq5kKILE1FHIUiiSPhe67odQ3huY6aY30fEWMZxwnF4SaKk4qWhD55niddx6FgNiPf8ygMAsq3W4UtY7lY0GazIZnnB8A+Wtcx5a/GDxJmuaPZtkPD4VCapklPT0/0+PhIz8/PJKWkr1ouc9VXx235vfCNkt8/dS3gbJAhetd1yfd91VuWRZPJhGzbpul0+hYoDMMDBGFE85knyemTP33QtaurKzo/P5cXFxdUq9Xo+vqaLi8vFbCHOfpWq0WDwUAFnHFp9uHNZjIQK7JdX9cMw6BOpyNxAeh2u4rk9vaWms0mVatV1YOMlfxLvaqP49iGhqxOT09lvV5XFzlb6vV6hEAg13VdIYpY2nz+BaFjaMigVCopQoxvbm6o3+8rJElC6/X68Obnj6UWufa61m63IVFCIrICdnVDZsvl8s+LwipMtgPstEf+TshyqVAoSGR3fHxMlUqFjo6O6OTkhHYP1Wg0qFwuqzVWQ8Vikc7Ozoj/wEfC17pJZISXxUFkCIAQpUAPBXg0nBmPx7Rgs29fjX1ACL+NRiMJv2EMr+ECPMjryuywCuTtZH9Sy3fC/YX/aO+EcRxTmqZb/ik5Oz/Psixne3wAS8z5gfLVaqXmu/FiMc8369V2vV4xodPW2DuQKiERwHeCXf4GB1XSURIOqkyO81E8p/uHibScmPxAGBpvcKauxbABDmBzgA/AOtfUvru7exvfm6Y9tTy72xtY5v3IH0/d8gt4/56uK3imyQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"macos-installation\" title=\"\" src=\"/static/997c7ed87d7cfdb089490c45c448da9b/0a47e/macos-installation.png\" srcset=\"/static/997c7ed87d7cfdb089490c45c448da9b/772e8/macos-installation.png 200w,\n/static/997c7ed87d7cfdb089490c45c448da9b/e17e5/macos-installation.png 400w,\n/static/997c7ed87d7cfdb089490c45c448da9b/0a47e/macos-installation.png 600w\" sizes=\"(max-width: 600px) 100vw, 600px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n</div>\n</div>\n<div class=\"flex-wrap responsive\">\n<p class=\"figure-title\"><b>Figure 1</b> PostgreSQL installer setting on macos</p>\n</div>\n<p>The additional installation instructions can be found on page <a href=\"https://www.enterprisedb.com/postgres-tutorials/installation-postgresql-mac-os\">Installation of PostgreSQL on Mac OS</a>.</p>\n<blockquote>\n<p>When using a separate installation of <em>pgAdmin 4</em>, the command line tools can be accessed at <code class=\"language-text\">/Applications/pgAdmin\\ 4.app/Contents/SharedSupport/</code>.</p>\n</blockquote>\n<h2 id=\"enabling-remote-connections\" style=\"position:relative;\"><a href=\"#enabling-remote-connections\" aria-label=\"enabling remote connections permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Enabling remote connections</h2>\n<blockquote>\n<p>We document here how to do it, but we advice against it. A more secure way is to use an SSH tunnel (described in the next section).</p>\n</blockquote>\n<p>Before we can make a remote connection to our database, we need to enable it. This applies also to remote connection using an SSH tunnel (described in the next section).</p>\n<p>In order to enable it, we edit the <code class=\"language-text\">/etc/postgresql/16/main/pg_hba.conf</code> file and make sure we add the following line:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">hostssl   all   all   samenet   scram-sha-256</code></pre></div>\n<p>Now, you should be able to connect using the <code class=\"language-text\">admin</code> role:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ /Library/PostgreSQL/16/bin/psql <span class=\"token parameter variable\">-h</span> idbox-1.local <span class=\"token parameter variable\">-p</span> <span class=\"token number\">5432</span> <span class=\"token parameter variable\">-U</span> admin idboxdb\nPassword <span class=\"token keyword\">for</span> user admin:\npsql <span class=\"token punctuation\">(</span><span class=\"token number\">16.1</span> <span class=\"token punctuation\">(</span>Ubuntu <span class=\"token number\">16.1</span>-1.pgdg20.04+1<span class=\"token punctuation\">))</span>\nType <span class=\"token string\">\"help\"</span> <span class=\"token keyword\">for</span> help.\n\n<span class=\"token assign-left variable\">idboxdb</span><span class=\"token operator\">=</span><span class=\"token comment\">#</span></code></pre></div>\n<p>Notice that if you try to connect using the <code class=\"language-text\">postgres</code> role, you will receive a bit misleading message:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ /Library/PostgreSQL/16/bin/psql <span class=\"token parameter variable\">-h</span> idbox-1.local <span class=\"token parameter variable\">-p</span> <span class=\"token number\">5432</span> <span class=\"token parameter variable\">-U</span> postgres idboxdb\nPassword <span class=\"token keyword\">for</span> user postgres:\npsql: error: FATAL:  password authentication failed <span class=\"token keyword\">for</span> user <span class=\"token string\">\"postgres\"</span>\nFATAL:  no pg_hba.conf entry <span class=\"token keyword\">for</span> <span class=\"token function\">host</span> <span class=\"token string\">\"fe80::10f4:3ecb:fb6d:eede%eth0\"</span>, user <span class=\"token string\">\"postgres\"</span>, database <span class=\"token string\">\"idboxdb\"</span>, SSL off</code></pre></div>\n<p>Specifically, the line saying:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">FATAL:  no pg_hba.conf entry <span class=\"token keyword\">for</span> <span class=\"token function\">host</span> <span class=\"token string\">\"fe80::10f4:3ecb:fb6d:eede%eth0\"</span>, user <span class=\"token string\">\"postgres\"</span>, database <span class=\"token string\">\"idboxdb\"</span>, SSL off</code></pre></div>\n<p>indicates we could add the following to our <code class=\"language-text\">pg_hba.conf</code> file. Yet, adding the following line:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">hostnossl   all   postgres  fe80::10f4:3ecb:fb6d:eede/32    scram-sha-256</code></pre></div>\n<p>would give us the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ /Library/PostgreSQL/16/bin/psql <span class=\"token parameter variable\">-h</span> idbox-1.local <span class=\"token parameter variable\">-p</span> <span class=\"token number\">5432</span> <span class=\"token parameter variable\">-U</span> postgres idboxdb\nPassword <span class=\"token keyword\">for</span> user postgres:\npsql: error: FATAL:  password authentication failed <span class=\"token keyword\">for</span> user <span class=\"token string\">\"postgres\"</span>\nFATAL:  password authentication failed <span class=\"token keyword\">for</span> user <span class=\"token string\">\"postgres\"</span></code></pre></div>\n<p>Looks like the client first tries to authenticate using ssl, but not being able to it falls back to clear text, but fails here as well. Which is good, because we do not even set a password for the <code class=\"language-text\">postgres</code> user, and we did it for a good reason. We will get a similar error if we try to use psql directly on the localhost (where the PostgreSQL server runs):</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">pi@idbox-1:~ $ psql <span class=\"token parameter variable\">-U</span> postgres test_db\npsql: FATAL:  Peer authentication failed <span class=\"token keyword\">for</span> user <span class=\"token string\">\"postgres\"</span></code></pre></div>\n<p>although here, the peer authentication mode is used.</p>\n<p>To wrap up, we remove the added <code class=\"language-text\">hostnossl</code> entry from the <code class=\"language-text\">pg_hba.conf</code> file. Then we will also remove entry:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">hostssl   all   all   samenet   scram-sha-256</code></pre></div>\n<p>effectively disabling the direct remote access to our database. In the next section, we will describe how to use an SSH tunnel to securely connect to our database.</p>\n<h2 id=\"using-ssh-tunnel-to-access-your-database-remotely\" style=\"position:relative;\"><a href=\"#using-ssh-tunnel-to-access-your-database-remotely\" aria-label=\"using ssh tunnel to access your database remotely permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Using SSH tunnel to access your database remotely</h2>\n<p>Using SSH tunnel is easy and secure way of connecting to your database remotely. First create a tunnel:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">ssh</span> <span class=\"token parameter variable\">-L</span> <span class=\"token number\">50000</span>:localhost:5432 idbox@idbox-1.local</code></pre></div>\n<p>Here, option <code class=\"language-text\">-L 50000</code> sets the local tunnel port to be <code class=\"language-text\">50000</code>. On the remote, we connect to <code class=\"language-text\">5432</code>: the default port of the PostgreSQL server.</p>\n<p>Now we can <code class=\"language-text\">psql</code> to <code class=\"language-text\">localhost</code> on port <code class=\"language-text\">50000</code> and work just as if we were on the remote:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ /Library/PostgreSQL/16/bin/psql <span class=\"token parameter variable\">-h</span> localhost <span class=\"token parameter variable\">-p</span> <span class=\"token number\">50000</span> <span class=\"token parameter variable\">-U</span> idbox idboxdb</code></pre></div>\n<p>Make sure that you do not use the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">ssh</span> <span class=\"token parameter variable\">-L</span> <span class=\"token number\">50000</span>:idbox-1.local:5432 idbox@idbox-1.local</code></pre></div>\n<p>In such a case, the remote PostgreSQL server would see the connection as if it is coming from the local network (e.g. <code class=\"language-text\">192.168.1.15</code>) rather than from the <code class=\"language-text\">localhost</code>. This would require you to enable the remote connection as we describe in the section above, and this is rather not what you want.</p>\n<p>Notice though that we still need to use the <code class=\"language-text\">admin</code> or <code class=\"language-text\">idbox</code> role to connect as the password authentication method will be used in this case. We consciously decided not to set the password for the default superuser <code class=\"language-text\">postgres</code> to keep it well protected.</p>\n<p>See <a href=\"https://www.postgresql.org/docs/current/ssh-tunnels.html\">Secure TCP/IP Connections with SSH Tunnels</a> for more information.</p>\n<h2 id=\"using-pgadmin-to-connect-to-postgresql-database\" style=\"position:relative;\"><a href=\"#using-pgadmin-to-connect-to-postgresql-database\" aria-label=\"using pgadmin to connect to postgresql database permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Using pgAdmin to connect to PostgreSQL database</h2>\n<p>pgAdmin also allows us to conveniently setup a tunnel. Right click on the <em>Servers</em> and select <em>Register</em> and then <em>Server...</em> from the menu. In the dialog that opens, in the <em>General</em> tab we fill in the name of the server (here it is <code class=\"language-text\">Identity Box</code>).</p>\n<p><a id=\"figure-2\"></a></p>\n<div class=\"scrollable flex-wrap responsive\">\n<div class=\"content-600\">\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/0361c0267cbbf63717c89dfd3e2a3b86/0a47e/pgAdmin-Server-General.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 78.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB6klEQVR42p2U3Y6bMBCFee7e9EEq9SlaVb3tRaVKvehNtd3tBgIJYGzzEzCE3zkdO5ttNpuVsot0MLbhYzxzbE8rRb7vI4ljpGmKeZ4xTRPGcXpoR9cex227LMsz2feqqiLvzyqiVZhA5wWSVGBXN1A6536OuuFnpZEXBeq6RpZJGGMcwILPNc0zebcMDGMJXbWQeQ1dthBSI9rGUPyTfpjQ9cOJRuwvaRhhup689Tal1TrGJlGQRcNgg6KqITgaG+E0L7zUGeMLOp3r9gMDN4L+BhEDJRQDLVTIHJkqkZcNKtOhaq5TsTPk+WFCt6sQW6GhSoOMl50K5SK1cNt/hcgL44zu/OgRaKO0OQ1TLkx5gKozybP2cdwCgyihO47QD2P3l6ru8PMmwrdf95zDvSvU8eNL8GdAG+F9sEEqSxehzBv2FHuNiBO9HIpypfphJM+uWxaHHBwjYD/hLZfzoXTApzkxbW8t8Go1prsMlA9Vkyc67198R+/+A4/Jf4uOcGGBPEB2u2nnwd1VfpMnVc9YOXvWpqlpeetJVZA1csa7o+snN2G64Ynak2f+CNXO8CHS8k6q2VotgkTj0/ff+PrjhjwhBPlBgM126ypFtNj7i7KnSs4nUVGU7oQqc82+XePdh894//EL/QNmP8Ujum4boQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"pgAdmin-Server-General\" title=\"\" src=\"/static/0361c0267cbbf63717c89dfd3e2a3b86/0a47e/pgAdmin-Server-General.png\" srcset=\"/static/0361c0267cbbf63717c89dfd3e2a3b86/772e8/pgAdmin-Server-General.png 200w,\n/static/0361c0267cbbf63717c89dfd3e2a3b86/e17e5/pgAdmin-Server-General.png 400w,\n/static/0361c0267cbbf63717c89dfd3e2a3b86/0a47e/pgAdmin-Server-General.png 600w\" sizes=\"(max-width: 600px) 100vw, 600px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n</div>\n</div>\n<div class=\"flex-wrap responsive\">\n<p class=\"figure-title\"><b>Figure 2</b> Server setup - General tab</p>\n</div>\n<p>Then in the <em>Connection</em> tab we set:</p>\n<p><a id=\"figure-3\"></a></p>\n<div class=\"scrollable flex-wrap responsive\">\n<div class=\"content-600\">\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/5fcf5056dc4509b77de4b63f5931341e/0a47e/pgAdmin-Server-Connection.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 78.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAACCUlEQVR42pWU246bQAyG5337GH2AvkPv+wDtba8qbQ+72mbTHFjCeWCGAQIESMhfe0hW1a5SJUifjBLjsT2/LaIoguOsEYUh0lTieDyi7wcMw4DD4WDtfn+wnH9jn3/hp+97lGUJkSmNTBusNiFmSxeJMsiUgtY5qm2NNFMwpiDnComUaJoW43ikwOMbBjpUOF6MxdrD7z8O5mTTfEtBNIIwRtN26Po9MWDXDS/2EnXTQWyCBKmukOU1JFldNDYgZ9cP+8m5n+hesXtla0pAPPsxHC9CKKl0U0MR3AJuBQe8loFodj3E/eMc3389Iki0LTc7BZSUJTvcQtXsIFw/sRlyIA6oqORYZsiLEh2X3A9XY0t+mC3w82EGLj1RpQ3o0vsmzOwh3NdbEEvHw9PCQRCrqWTClFvkprSWT72Wqm4h/DijbCSiNH+55UDm8BJlZXAL5bblDH0sn32s3ICCGhRVi7u5hx9z3zqkOUnKbK+CfYUXprZMXbRWi/x+IMXzNFg58MhdAY9m25Fs1m4Ivuns1D9FJ7V2Ki5r7vzfNEUT/M2WJ4X7dha0VNNNcVBV1BPmLbpsqKLJsiq4TV23t6MqUpUjSjIaP4PmdMr/qOodtKlIAbW1RVXDjTQ+f5vj6/0aIo4TrNYOpEztGjqvo0vPOI60fYzdQDlvIaNx9+Ti3YdPeP/xC/4CCaPHgjp7PLgAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"pgAdmin-Server-Connection\" title=\"\" src=\"/static/5fcf5056dc4509b77de4b63f5931341e/0a47e/pgAdmin-Server-Connection.png\" srcset=\"/static/5fcf5056dc4509b77de4b63f5931341e/772e8/pgAdmin-Server-Connection.png 200w,\n/static/5fcf5056dc4509b77de4b63f5931341e/e17e5/pgAdmin-Server-Connection.png 400w,\n/static/5fcf5056dc4509b77de4b63f5931341e/0a47e/pgAdmin-Server-Connection.png 600w\" sizes=\"(max-width: 600px) 100vw, 600px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n</div>\n</div>\n<div class=\"flex-wrap responsive\">\n<p class=\"figure-title\"><b>Figure 3</b> Server setup - Connection tab</p>\n</div>\n<p>Here notice that we set the hostname to be <code class=\"language-text\">localhost</code>: this is because we will be using the SSH tunnel. <em>Port</em> refers to the port on which the database is listening on the remote server (default is usually <code class=\"language-text\">5432</code>). As maintenance database we set the default database that has been created when PostgreSQL was installed and set up.</p>\n<p>Finally, we set up the SSH tunnel (in the example below, we use a different hostname than we used previously in the examples):</p>\n<p><a id=\"figure-4\"></a></p>\n<div class=\"scrollable flex-wrap responsive\">\n<div class=\"content-600\">\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/72ee83e6dc6bb89b274b710aeef5ea63/0a47e/pgAdmin-Server-SSHTunnel.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 78.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAACV0lEQVR42o2UyW4UMRCG+zW5cYeXQEhc4RVQJG45ccqFGwixSRAUkVl6pnt6t3t1r9Pj+alyTyCZZBAtfWrLcv0u11+2FYYhbNuG53ngsdYa2+3WsNvtMI4jzfF/92duv9/fgb9hGFBVFaxESKRpjiwvEMUJlGoQRgmNBYI4xdV8jYUTQNCaMIqh6gbjjjblDe4wmr9luwHmtovZ0oFNgUXV4dOVgw+XK+RVi0CUCGWJOK2QZGoiVX/HR1grErxeONgEwkykeY2QsnO9AIlI0Q3bif6I4T5128PyQon1JkIoCggSlCRYVrUJ6oeJ20HDdjxJ2w2wlmsfV9c2giSHIDEWjCkzVbfoaRGbsdf7A9oE3mx0TNNRhq6fTBmSIB9ZFjXSbDJpoEVulOHbbIMfSx/fFz6yskHbc/BwD9V0sFiMTeFMudicJR83JMfbWuHs4gsePTvDk5fnePziDT6TYTmJRgejjjGC7PRUw+nIQuambeJEYuPThusNrqkLHC8ydTo2qB9GFKWC4/qwFqsNfi3WiFiQxXJFbnWm3ypVo6Fx1/ck1Jnm3Z4whGvIdbfcYKohtw0fgzPMaLeiaqgm/R0qpu5OUiqqoePH5sjc1KHIjaAXSfhRakx6qE7/wmIBWTQGc+RDL96M/4eEhCI5YbER4iDwv1ncXDOOjakzMkqm7eimUEmsWGQIIrp2dPk7cuuh/roNX6+8rKlmLQkpY94qkHj7/ifefZ3D8n1fz2Zz7Xm+pldI03Ol6Yk6CT1hWkippUzpn+pUJPrj5VI/fXWun7++0L8Bt2W8MjjPgfEAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"pgAdmin-Server-SSHTunnel\" title=\"\" src=\"/static/72ee83e6dc6bb89b274b710aeef5ea63/0a47e/pgAdmin-Server-SSHTunnel.png\" srcset=\"/static/72ee83e6dc6bb89b274b710aeef5ea63/772e8/pgAdmin-Server-SSHTunnel.png 200w,\n/static/72ee83e6dc6bb89b274b710aeef5ea63/e17e5/pgAdmin-Server-SSHTunnel.png 400w,\n/static/72ee83e6dc6bb89b274b710aeef5ea63/0a47e/pgAdmin-Server-SSHTunnel.png 600w\" sizes=\"(max-width: 600px) 100vw, 600px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n</div>\n</div>\n<div class=\"flex-wrap responsive\">\n<p class=\"figure-title\"><b>Figure 4</b> Server setup - SSH Tunnel tab</p>\n</div>\n<p>We are now ready to connect. After you <em>Save</em> the server configuration, <em>pgAdmin 4</em> client should connect to your server.\nWhen you restart the app, you need to reconnect by double clicking the <em>Identity Box</em> server group. You will be asked for the password associated with the SSH key that you provided in the <em>SSH Tunnel</em> tab:</p>\n<p><a id=\"figure-5\"></a></p>\n<div class=\"scrollable flex-wrap responsive\">\n<div class=\"content-600\">\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/b0bd3710d0b6f3b50a59c3c1ab7fd229/0a47e/pgAdmin-ConnectServer.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 41.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABNUlEQVR42qWRS27CMBCGfbreqLsepJueoaseoKpEaXkFEHRRQN0kkITEScCJEzv+O3YAsamqqiN9msdvjz022+/38H0fYRgiCAIopWDNGHPx5/ict23ruNa01hBCgBVFgTRNwDknnyKOY5fbmBNJ0mnWR1GEPM/xk9nmbLfboffax2jsYTgaY+JNMZ546PXf8D4YYr5YYjqbkz7BgPTF8gOfqzVW6w38YAvdGjRKOzTdmsX8gIjIjhXSonQkuegoBOVdfF2P0txh91qdH4TrYdczUUlwCjIqZuQPokJVK0dZN44uby512Zx02ThEVSOnCx1LCWbnllLSg1LhWKKmjf8x5n7r+mGJ1v7kLyjdoqTplGrgxxwvsw0WX1vX0PwVey5NYsIoNqLIzOOzZ25u783dw5P5BkFNZbP4TRYAAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"pgAdmin-ConnectServer\" title=\"\" src=\"/static/b0bd3710d0b6f3b50a59c3c1ab7fd229/0a47e/pgAdmin-ConnectServer.png\" srcset=\"/static/b0bd3710d0b6f3b50a59c3c1ab7fd229/772e8/pgAdmin-ConnectServer.png 200w,\n/static/b0bd3710d0b6f3b50a59c3c1ab7fd229/e17e5/pgAdmin-ConnectServer.png 400w,\n/static/b0bd3710d0b6f3b50a59c3c1ab7fd229/0a47e/pgAdmin-ConnectServer.png 600w\" sizes=\"(max-width: 600px) 100vw, 600px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n</div>\n</div>\n<div class=\"flex-wrap responsive\">\n<p class=\"figure-title\"><b>Figure 5</b> Connecting to the server - SSH Key Password</p>\n</div>\n<p>Enter your password (or leave it empty if your key does not have associated password) and hit <em>OK</em>.</p>\n<p>pgAdmin is now connected to your remote database using an SSH Tunnel.</p>\n<p>For more information how to connect to the PostgreSQL database check <a href=\"https://www.enterprisedb.com/postgres-tutorials/connecting-postgresql-using-psql-and-pgadmin\">Connecting PostgreSQL using psql and pgAdmin</a>.</p>\n<h2 id=\"installation-on-raspberrypi\" style=\"position:relative;\"><a href=\"#installation-on-raspberrypi\" aria-label=\"installation on raspberrypi permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Installation On RaspberryPi</h2>\n<blockquote>\n<p>In the past, the overall support for ARM architecture with popular software could pose some challenges. PostgreSQL was not exception here and this is why I still keep this section as a reference. It should not be needed anymore, but maybe someone will find it still useful. It was written some time ago, when PostgreSQL was at version 11.</p>\n</blockquote>\n<p>We followed the <a href=\"https://www.postgresql.org/download/linux/ubuntu/\">instructions</a> from the regular Ubuntu distribution, with just a few exceptions.</p>\n<p>The instruction:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> <span class=\"token function\">sh</span> <span class=\"token parameter variable\">-c</span> <span class=\"token string\">'echo \"deb http://apt.postgresql.org/pub/repos/apt $(lsb_release -cs)-pgdg main\" > /etc/apt/sources.list.d/pgdg.list'</span></code></pre></div>\n<p>caused some troubles on our RaspberryPi. It basically adds a file <code class=\"language-text\">/etc/apt/sources.list.d/pgdg.list</code> with the following content:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">deb http://apt.postgresql.org/pub/repos/apt buster-pgdg main</code></pre></div>\n<p>Unfortunately, when we then run:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">wget</span> <span class=\"token parameter variable\">--quiet</span> <span class=\"token parameter variable\">-O</span> - https://www.postgresql.org/media/keys/ACCC4CF8.asc <span class=\"token operator\">|</span> <span class=\"token function\">sudo</span> apt-key <span class=\"token function\">add</span> -\nOK</code></pre></div>\n<p>followed by</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> update\nHit:1 http://raspbian.raspberrypi.org/raspbian buster InRelease\nHit:2 http://archive.raspberrypi.org/debian buster InRelease\nGet:3 https://dl.yarnpkg.com/debian stable InRelease <span class=\"token punctuation\">[</span><span class=\"token number\">17.1</span> kB<span class=\"token punctuation\">]</span>\nHit:4 http://apt.postgresql.org/pub/repos/apt buster-pgdg InRelease\nFetched <span class=\"token number\">17.1</span> kB <span class=\"token keyword\">in</span> 1s <span class=\"token punctuation\">(</span><span class=\"token number\">11.7</span> kB/s<span class=\"token punctuation\">)</span>\nReading package lists<span class=\"token punctuation\">..</span>. Done\nN: Skipping acquire of configured <span class=\"token function\">file</span> <span class=\"token string\">'main/binary-armhf/Packages'</span> as repository <span class=\"token string\">'http://apt.postgresql.org/pub/repos/apt buster-pgdg InRelease'</span> doesn<span class=\"token string\">'t support architecture '</span>armhf'</code></pre></div>\n<p>we get the above mentioned error.</p>\n<p>We decided to remove the <code class=\"language-text\">/etc/apt/sources.list.d/pgdg.list</code> and then the complete set of instructions to instal PostgreSQL on RaspberryPi is:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">wget</span> <span class=\"token parameter variable\">--quiet</span> <span class=\"token parameter variable\">-O</span> - https://www.postgresql.org/media/keys/ACCC4CF8.asc <span class=\"token operator\">|</span> <span class=\"token function\">sudo</span> apt-key <span class=\"token function\">add</span> -\n$ <span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> update\n$ <span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> <span class=\"token function\">install</span> postgresql\n<span class=\"token punctuation\">..</span>.\nThe following additional packages will be installed:\n  libllvm7 libpq5 postgresql-11 postgresql-client-11 postgresql-client-common postgresql-common ssl-cert sysstat\ncreating subdirectories <span class=\"token punctuation\">..</span>. ok\nselecting default max_connections <span class=\"token punctuation\">..</span>. <span class=\"token number\">100</span>\nselecting default shared_buffers <span class=\"token punctuation\">..</span>. 128MB\nselecting default timezone <span class=\"token punctuation\">..</span>. Europe/Amsterdam\nselecting dynamic shared memory implementation <span class=\"token punctuation\">..</span>. posix\ncreating configuration files <span class=\"token punctuation\">..</span>. ok\nrunning bootstrap script <span class=\"token punctuation\">..</span>. ok\nperforming post-bootstrap initialization <span class=\"token punctuation\">..</span>. ok\nsyncing data to disk <span class=\"token punctuation\">..</span>. ok\n\nSuccess. You can now start the database server using:\n\n    pg_ctlcluster <span class=\"token number\">11</span> main start\n\nVer Cluster Port Status Owner    Data directory              Log <span class=\"token function\">file</span>\n<span class=\"token number\">11</span>  main    <span class=\"token number\">5432</span> down   postgres /var/lib/postgresql/11/main /var/log/postgresql/postgresql-11-main.log\nupdate-alternatives: using /usr/share/postgresql/11/man/man1/postmaster.1.gz to provide /usr/share/man/man1/postmaster.1.gz <span class=\"token punctuation\">(</span>postmaster.1.gz<span class=\"token punctuation\">)</span> <span class=\"token keyword\">in</span> auto mode\nSetting up postgresql <span class=\"token punctuation\">(</span><span class=\"token number\">11</span>+200+deb10u4<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">..</span>.\nProcessing triggers <span class=\"token keyword\">for</span> systemd <span class=\"token punctuation\">(</span><span class=\"token number\">241</span>-7~deb10u4+rpi1<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">..</span>.\nProcessing triggers <span class=\"token keyword\">for</span> man-db <span class=\"token punctuation\">(</span><span class=\"token number\">2.8</span>.5-2<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">..</span>.\nProcessing triggers <span class=\"token keyword\">for</span> libc-bin <span class=\"token punctuation\">(</span><span class=\"token number\">2.28</span>-10+rpi1<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">..</span>.</code></pre></div>\n<p>Finally, we figure out how to start the service:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">pi@idbox-1:~ $ pg_ctlcluster <span class=\"token number\">11</span> main start\nWarning: the cluster will not be running as a systemd service. Consider using systemctl:\n  <span class=\"token function\">sudo</span> systemctl start postgresql@11-main\nError: You must run this program as the cluster owner <span class=\"token punctuation\">(</span>postgres<span class=\"token punctuation\">)</span> or root\npi@idbox-1:~ $ <span class=\"token function\">sudo</span> systemctl start postgresql@11-main\n\n<span class=\"token function\">sudo</span> pg_ctlcluster <span class=\"token number\">11</span> main status\npg_ctl: server is running <span class=\"token punctuation\">(</span>PID: <span class=\"token number\">6677</span><span class=\"token punctuation\">)</span>\n/usr/lib/postgresql/11/bin/postgres <span class=\"token string\">\"-D\"</span> <span class=\"token string\">\"/var/lib/postgresql/11/main\"</span> <span class=\"token string\">\"-c\"</span> <span class=\"token string\">\"config_file=/etc/postgresql/11/main/postgresql.conf\"</span>\n\npi@idbox-1:~ $ <span class=\"token function\">sudo</span> systemctl status postgresql@11-main\n‚óè postgresql@11-main.service - PostgreSQL Cluster <span class=\"token number\">11</span>-main\n   Loaded: loaded <span class=\"token punctuation\">(</span>/lib/systemd/system/postgresql@.service<span class=\"token punctuation\">;</span> enabled-runtime<span class=\"token punctuation\">;</span> vendor preset: enabled<span class=\"token punctuation\">)</span>\n   Active: active <span class=\"token punctuation\">(</span>running<span class=\"token punctuation\">)</span> since Fri <span class=\"token number\">2021</span>-02-19 <span class=\"token number\">10</span>:34:31 CET<span class=\"token punctuation\">;</span> 8min ago\n Main PID: <span class=\"token number\">6677</span> <span class=\"token punctuation\">(</span>postgres<span class=\"token punctuation\">)</span>\n    Tasks: <span class=\"token number\">7</span> <span class=\"token punctuation\">(</span>limit: <span class=\"token number\">4915</span><span class=\"token punctuation\">)</span>\n   CGroup: /system.slice/system-postgresql.slice/postgresql@11-main.service\n           ‚îú‚îÄ6677 /usr/lib/postgresql/11/bin/postgres <span class=\"token parameter variable\">-D</span> /var/lib/postgresql/11/main <span class=\"token parameter variable\">-c</span> <span class=\"token assign-left variable\">config_file</span><span class=\"token operator\">=</span>/etc/postgresql/11/m\n           ‚îú‚îÄ6682 postgres: <span class=\"token number\">11</span>/main: checkpointer\n           ‚îú‚îÄ6683 postgres: <span class=\"token number\">11</span>/main: background writer\n           ‚îú‚îÄ6684 postgres: <span class=\"token number\">11</span>/main: walwriter\n           ‚îú‚îÄ6685 postgres: <span class=\"token number\">11</span>/main: autovacuum launcher\n           ‚îú‚îÄ6686 postgres: <span class=\"token number\">11</span>/main: stats collector\n           ‚îî‚îÄ6687 postgres: <span class=\"token number\">11</span>/main: logical replication launcher\n\nFeb <span class=\"token number\">19</span> <span class=\"token number\">10</span>:34:27 idbox-1 systemd<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>: Starting PostgreSQL Cluster <span class=\"token number\">11</span>-main<span class=\"token punctuation\">..</span>.\nFeb <span class=\"token number\">19</span> <span class=\"token number\">10</span>:34:31 idbox-1 systemd<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>: Started PostgreSQL Cluster <span class=\"token number\">11</span>-main.</code></pre></div>\n<p>From the above, we also read the location of the PostgreSQL configuration file: <code class=\"language-text\">/etc/postgresql/11/main/postgresql.conf</code>. We will need it later.</p>\n<p>For now, we will need to edit other file: <em>PostgreSQL Client Authentication Configuration File</em>. To find its location, run:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> <span class=\"token function\">su</span> postgres\npostgres@idbox-1:/home/pi$ psql\npsql <span class=\"token punctuation\">(</span><span class=\"token number\">11.10</span> <span class=\"token punctuation\">(</span>Raspbian <span class=\"token number\">11.10</span>-0+deb10u1<span class=\"token punctuation\">))</span>\nType <span class=\"token string\">\"help\"</span> <span class=\"token keyword\">for</span> help.\n\n<span class=\"token assign-left variable\">postgres</span><span class=\"token operator\">=</span><span class=\"token comment\"># SHOW hba_file;</span>\n              hba_file\n-------------------------------------\n /etc/postgresql/11/main/pg_hba.conf\n<span class=\"token punctuation\">(</span><span class=\"token number\">1</span> row<span class=\"token punctuation\">)</span>\n\n<span class=\"token assign-left variable\">postgres</span><span class=\"token operator\">=</span><span class=\"token comment\"># q</span>\npostgres-<span class=\"token comment\"># \\q</span>\npostgres@idbox-1:/home/pi$ <span class=\"token builtin class-name\">exit</span></code></pre></div>\n<p>We record the file location: <code class=\"language-text\">/etc/postgresql/11/main/pg_hba.conf</code>.</p>\n<style scoped>\n.scrollable {\n  width: 100%;\n  overflow-x: auto;\n}\n.flex-wrap {\n  display:flex;\n  flex-flow:column;\n  justify-content:center;\n  align-items: center;\n}\n@media (max-width: 650px) {\n  .responsive {\n    align-items: flex-start;\n  }  \n}\n.figure-title {\n  font-size: 0.8em\n}\n.bordered-content-600 {\n  width: 600px;\n  border: 1px solid black;\n}\n.content-600 {\n  width: 600px;\n}\n.bordered-content-300 {\n  width: 300px;\n  border: 1px solid black;\n}\n</style>","fileAbsolutePath":"/home/runner/work/identity-box/identity-box/workspaces/homepage/src/pages/developers/postgresql.md","frontmatter":{"title":"PostgreSQL: Identity Box database","content":null}},"mdx":null},"pageContext":{"templatePath":"/developers/postgresql"}},"staticQueryHashes":["1639663795"],"slicesMap":{}}